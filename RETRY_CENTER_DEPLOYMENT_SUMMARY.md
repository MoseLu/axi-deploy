# é‡è¯•ä¸­å¿ƒéƒ¨ç½²æ€»ç»“

## éƒ¨ç½²æ¦‚è¿°

é‡è¯•ä¸­å¿ƒå·²æˆåŠŸéƒ¨ç½²åˆ° axi-deploy é¡¹ç›®ä¸­ï¼Œä½œä¸ºä¸€ä¸ªå¯å¤ç”¨çš„ GitHub Actions å·¥ä½œæµï¼Œç”¨äºç»Ÿä¸€ç®¡ç†æ‰€æœ‰å·¥ä½œæµä¸­çš„é‡è¯•æœºåˆ¶ã€‚

## å·²åˆ›å»ºçš„æ–‡ä»¶

### 1. é‡è¯•ä¸­å¿ƒæ ¸å¿ƒæ–‡ä»¶
- `.github/actions/retry-center/action.yml` - é‡è¯•ä¸­å¿ƒActioné…ç½®
- `.github/actions/retry-center/retry-logic.sh` - é‡è¯•é€»è¾‘è„šæœ¬
- `.github/actions/retry-center/retry-config.yml` - é‡è¯•é…ç½®
- `.github/actions/retry-center/README.md` - é‡è¯•ä¸­å¿ƒæ–‡æ¡£

### 2. é‡è¯•ä¸­å¿ƒå¯å¤ç”¨å·¥ä½œæµ
- `.github/workflows/retry-center.yml` - é‡è¯•ä¸­å¿ƒå¯å¤ç”¨å·¥ä½œæµ
- `.github/workflows/retry-center-example.yml` - ä½¿ç”¨ç¤ºä¾‹å·¥ä½œæµ

### 3. éƒ¨ç½²è„šæœ¬
- `scripts/apply-retry-center.sh` - é‡è¯•ä¸­å¿ƒåº”ç”¨æ£€æŸ¥è„šæœ¬
- `scripts/deploy-retry-center.sh` - é‡è¯•ä¸­å¿ƒéƒ¨ç½²è„šæœ¬
- `scripts/deploy-retry-center-workflow.sh` - é‡è¯•ä¸­å¿ƒå·¥ä½œæµéƒ¨ç½²è„šæœ¬

### 4. æ–‡æ¡£
- `RETRY_CENTER_USAGE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- `RETRY_CENTER_DEPLOYMENT_SUMMARY.md` - æœ¬éƒ¨ç½²æ€»ç»“æ–‡æ¡£

## å·²åº”ç”¨é‡è¯•ä¸­å¿ƒçš„å·¥ä½œæµ

### 1. deploy-project.yml
- âœ… å·²åº”ç”¨é‡è¯•ä¸­å¿ƒåˆ°"ä¸‹è½½æ„å»ºäº§ç‰©"æ­¥éª¤
- ğŸ”§ é…ç½®ï¼š3æ¬¡é‡è¯•ï¼Œ10ç§’å»¶è¿Ÿï¼ŒæŒ‡æ•°é€€é¿ç­–ç•¥
- ğŸ“Š ç±»å‹ï¼šç½‘ç»œæ“ä½œ

### 2. start-service.yml
- âœ… å·²åº”ç”¨é‡è¯•ä¸­å¿ƒåˆ°"å¯åŠ¨æœåŠ¡"æ­¥éª¤
- ğŸ”§ é…ç½®ï¼š2æ¬¡é‡è¯•ï¼Œ15ç§’å»¶è¿Ÿï¼ŒæŒ‡æ•°é€€é¿ç­–ç•¥
- ğŸ“Š ç±»å‹ï¼šæœåŠ¡å¯åŠ¨

### 3. health-check.yml
- âš ï¸ éœ€è¦æ‰‹åŠ¨åº”ç”¨é‡è¯•ä¸­å¿ƒ
- ğŸ”§ å»ºè®®é…ç½®ï¼š2æ¬¡é‡è¯•ï¼Œ10ç§’å»¶è¿Ÿï¼Œç®€å•ç­–ç•¥
- ğŸ“Š ç±»å‹ï¼šå¥åº·æ£€æŸ¥

## é‡è¯•ä¸­å¿ƒç‰¹æ€§

### ğŸ¯ æ™ºèƒ½é‡è¯•ç­–ç•¥
- **Simple (ç®€å•é‡è¯•)**ï¼šå›ºå®šå»¶è¿Ÿæ—¶é—´
- **Exponential (æŒ‡æ•°é€€é¿)**ï¼šå»¶è¿Ÿæ—¶é—´é€’å¢
- **Adaptive (è‡ªé€‚åº”é‡è¯•)**ï¼šæ ¹æ®é”™è¯¯ç±»å‹è°ƒæ•´å»¶è¿Ÿ

### ğŸ“Š è¿›åº¦è·Ÿè¸ª
- å®æ—¶è·Ÿè¸ªæ‰§è¡Œè¿›åº¦å’Œé‡è¯•çŠ¶æ€
- è¯¦ç»†çš„é‡è¯•æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
- æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

### ğŸ”§ çµæ´»é…ç½®
- æ ¹æ®ä¸åŒæ­¥éª¤ç±»å‹è‡ªåŠ¨é€‰æ‹©é‡è¯•ç­–ç•¥
- æ”¯æŒè‡ªå®šä¹‰é‡è¯•æ¬¡æ•°ã€å»¶è¿Ÿå’Œè¶…æ—¶
- ç¯å¢ƒå˜é‡æ”¯æŒ

### ğŸ“ˆ è¯¦ç»†æŠ¥å‘Š
- è‡ªåŠ¨ç”ŸæˆJSONæ ¼å¼çš„æ‰§è¡ŒæŠ¥å‘Š
- æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡
- é”™è¯¯ç±»å‹åˆ†æ

### ğŸ”” å¤±è´¥é€šçŸ¥
- æ”¯æŒå¤šç§é€šçŸ¥æ¸ é“
- å¯é…ç½®çš„é€šçŸ¥æ¡ä»¶
- è¯¦ç»†çš„å¤±è´¥ä¿¡æ¯

## ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ç”¨æ³•
```yaml
- name: ä½¿ç”¨é‡è¯•ä¸­å¿ƒæ‰§è¡Œå‘½ä»¤
  uses: ./.github/workflows/retry-center.yml
  with:
    step_name: "æ­¥éª¤åç§°"
    command: "è¦æ‰§è¡Œçš„å‘½ä»¤"
    max_retries: 3
    retry_delay: 5
    timeout_minutes: 10
    strategy: "exponential"
    step_type: "network"
    continue_on_error: false
    notify_on_failure: true
```

### åœ¨deploy-project.ymlä¸­çš„ä½¿ç”¨
```yaml
- name: ä¸‹è½½æ„å»ºäº§ç‰©
  uses: ./.github/workflows/retry-center.yml
  with:
    step_name: "ä¸‹è½½æ„å»ºäº§ç‰©"
    command: |
      gh run download ${{ inputs.run_id }} \
        --name "dist-${{ inputs.project }}" \
        --dir . \
        --repo ${{ inputs.source_repo }}
    max_retries: 3
    retry_delay: 10
    timeout_minutes: 15
    strategy: "exponential"
    step_type: "network"
    continue_on_error: false
    notify_on_failure: true
    env_vars: '{"GH_TOKEN": "${{ inputs.deploy_center_pat || github.token }}"}'
```

## è¾“å‡ºå‚æ•°

é‡è¯•ä¸­å¿ƒå·¥ä½œæµæä¾›ä»¥ä¸‹è¾“å‡ºå‚æ•°ï¼š

| å‚æ•° | æè¿° |
|------|------|
| success | æ‰§è¡Œæ˜¯å¦æˆåŠŸ |
| attempts | å®é™…é‡è¯•æ¬¡æ•° |
| execution_time | æ€»æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰ |
| error_message | é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰ |
| retry_report | é‡è¯•æŠ¥å‘Šï¼ˆJSONæ ¼å¼ï¼‰ |

## é‡è¯•æŠ¥å‘Šç¤ºä¾‹

```json
{
  "step_name": "ä¸‹è½½æ„å»ºäº§ç‰©",
  "workflow_run_id": "123456789",
  "job_name": "retry-execution",
  "timestamp": "2024-01-01T12:00:00Z",
  "success": true,
  "attempts": 1,
  "execution_time_seconds": 45,
  "error_message": "",
  "retry_config": {
    "max_retries": 3,
    "retry_delay": 10,
    "timeout_minutes": 15,
    "strategy": "exponential",
    "step_type": "network"
  },
  "environment": {
    "runner": "ubuntu-latest",
    "workflow": "deploy-project",
    "repository": "owner/repo"
  }
}
```

## æ­¥éª¤ç±»å‹é…ç½®

| ç±»å‹ | é»˜è®¤é‡è¯•æ¬¡æ•° | é»˜è®¤å»¶è¿Ÿ | é»˜è®¤è¶…æ—¶ | é»˜è®¤ç­–ç•¥ | æ˜¯å¦å¯é‡è¯• |
|------|-------------|----------|----------|----------|------------|
| network | 3 | 5s | 10min | exponential | æ˜¯ |
| file_operation | 2 | 3s | 5min | simple | æ˜¯ |
| validation | 0 | 0s | 2min | simple | å¦ |
| parsing | 0 | 0s | 1min | simple | å¦ |

## ä¸‹ä¸€æ­¥æ“ä½œ

### 1. æµ‹è¯•é‡è¯•ä¸­å¿ƒ
è¿è¡Œç¤ºä¾‹å·¥ä½œæµæµ‹è¯•é‡è¯•ä¸­å¿ƒåŠŸèƒ½ï¼š
```bash
# åœ¨GitHub Actionsä¸­æ‰‹åŠ¨è§¦å‘ retry-center-example.yml
```

### 2. åº”ç”¨åˆ°å…¶ä»–å·¥ä½œæµ
å°†é‡è¯•ä¸­å¿ƒåº”ç”¨åˆ°å…¶ä»–éœ€è¦é‡è¯•æœºåˆ¶çš„å·¥ä½œæµï¼š
- `configure-nginx.yml`
- `download-and-validate.yml`
- `validate-artifact.yml`
- `backup-deployment.yml`
- `rollback.yml`

### 3. ç›‘æ§å’Œä¼˜åŒ–
- ç›‘æ§é‡è¯•é¢‘ç‡å’ŒæˆåŠŸç‡
- æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é‡è¯•ç­–ç•¥
- ä¼˜åŒ–è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°

### 4. é›†æˆåˆ°Dashboard
ä¸ºæœªæ¥é›†æˆåˆ° axi-project-dashboard åšå‡†å¤‡ï¼š
- å®æ—¶è¿›åº¦æ˜¾ç¤º
- å†å²è®°å½•æŸ¥çœ‹
- é…ç½®ç®¡ç†ç•Œé¢
- å‘Šè­¦è®¾ç½®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é‡è¯•æ¬¡æ•°è¿‡å¤š**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯æœåŠ¡å™¨çŠ¶æ€
   - è°ƒæ•´é‡è¯•ç­–ç•¥

2. **è¶…æ—¶é”™è¯¯**
   - å¢åŠ è¶…æ—¶æ—¶é—´
   - æ£€æŸ¥å‘½ä»¤å¤æ‚åº¦
   - ä¼˜åŒ–æ‰§è¡Œé€»è¾‘

3. **æƒé™é”™è¯¯**
   - æ£€æŸ¥è®¤è¯ä¿¡æ¯
   - éªŒè¯è®¿é—®æƒé™
   - ç¡®è®¤å¯†é’¥æœ‰æ•ˆæ€§

### è°ƒè¯•æŠ€å·§

1. å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼šè®¾ç½® `GITHUB_ACTIONS_STEP_DEBUG=true`
2. æŸ¥çœ‹é‡è¯•æŠ¥å‘Šï¼šæ£€æŸ¥ç”Ÿæˆçš„JSONæŠ¥å‘Š
3. åˆ†æé”™è¯¯æ¨¡å¼ï¼šæ ¹æ®é”™è¯¯ç±»å‹è°ƒæ•´ç­–ç•¥

## æ€»ç»“

é‡è¯•ä¸­å¿ƒå·²æˆåŠŸéƒ¨ç½²å¹¶éƒ¨åˆ†åº”ç”¨åˆ°å…³é”®å·¥ä½œæµä¸­ã€‚å®ƒæä¾›äº†ï¼š

- âœ… ç»Ÿä¸€çš„é‡è¯•æœºåˆ¶ç®¡ç†
- âœ… æ™ºèƒ½é‡è¯•ç­–ç•¥
- âœ… è¯¦ç»†çš„æ‰§è¡ŒæŠ¥å‘Š
- âœ… çµæ´»çš„é…ç½®é€‰é¡¹
- âœ… å¤±è´¥é€šçŸ¥åŠŸèƒ½

å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é‡è¯•ä¸­å¿ƒåŠŸèƒ½åï¼Œé€æ­¥åº”ç”¨åˆ°å…¶ä»–å·¥ä½œæµä¸­ï¼Œä»¥æé«˜æ•´ä¸ªéƒ¨ç½²ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

---

**éƒ¨ç½²æ—¶é—´**: $(date)
**éƒ¨ç½²çŠ¶æ€**: âœ… å®Œæˆ
**ä¸‹ä¸€æ­¥**: æµ‹è¯•å’Œä¼˜åŒ–
