name: Quick Deployment Test

on:
  workflow_dispatch:
    inputs:
      project:
        description: 'é¡¹ç›®åç§°'
        required: true
        type: string
        default: 'axi-docs'

jobs:
  quick-test:
    runs-on: ubuntu-latest
    steps:
      - name: å¿«é€Ÿæ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          port: ${{ secrets.SERVER_PORT }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_KEY }}
          script: |
            echo "ğŸš€ å¿«é€Ÿéƒ¨ç½²çŠ¶æ€æ£€æŸ¥"
            echo "é¡¹ç›®: ${{ github.event.inputs.project }}"
            echo "æ—¶é—´: $(date)"
            echo ""
            
            # æ£€æŸ¥éƒ¨ç½²ç›®å½•
            deploy_path="/www/wwwroot/${{ github.event.inputs.project }}"
            if [ -d "$deploy_path" ]; then
              echo "âœ… éƒ¨ç½²ç›®å½•å­˜åœ¨: $deploy_path"
              
              # æ£€æŸ¥æ–‡ä»¶æ•°é‡
              file_count=$(find "$deploy_path" -type f | wc -l)
              echo "ğŸ“ æ–‡ä»¶æ•°é‡: $file_count"
              
              # æ£€æŸ¥æœ€æ–°ä¿®æ”¹æ—¶é—´
              latest_file=$(find "$deploy_path" -type f -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)
              if [ -n "$latest_file" ]; then
                echo "ğŸ•’ æœ€æ–°æ–‡ä»¶: $latest_file"
                echo "   ä¿®æ”¹æ—¶é—´: $(stat -c %y "$latest_file")"
              fi
              
              # æ£€æŸ¥å…³é”®æ–‡ä»¶
              if [ -f "$deploy_path/index.html" ]; then
                echo "âœ… index.html å­˜åœ¨"
              else
                echo "âŒ index.html ä¸å­˜åœ¨"
              fi
              
            else
              echo "âŒ éƒ¨ç½²ç›®å½•ä¸å­˜åœ¨: $deploy_path"
            fi
            
            echo ""
            echo "âœ… å¿«é€Ÿæ£€æŸ¥å®Œæˆ"

      - name: æµ‹è¯•ç½‘ç«™å“åº”
        run: |
          echo "ğŸŒ æµ‹è¯•ç½‘ç«™å“åº”..."
          test_url="https://docs.axiom.top"
          
          # æµ‹è¯•HTTPå“åº”
          response=$(curl -s -o /dev/null -w "%{http_code}" "$test_url" 2>/dev/null || echo "000")
          echo "HTTPå“åº”ç : $response"
          
          if [ "$response" = "200" ]; then
            echo "âœ… ç½‘ç«™æ­£å¸¸å“åº”"
          else
            echo "âŒ ç½‘ç«™å“åº”å¼‚å¸¸"
          fi 