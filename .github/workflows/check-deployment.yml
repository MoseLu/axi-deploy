name: Check Deployment Status

on:
  workflow_dispatch:
    inputs:
      project:
        description: 'é¡¹ç›®åç§°'
        required: true
        type: string
      deploy_path:
        description: 'éƒ¨ç½²è·¯å¾„'
        required: true
        type: string

permissions:
  contents: read

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          port: ${{ secrets.SERVER_PORT }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_KEY }}
          script: |
            echo "ğŸ” æ£€æŸ¥éƒ¨ç½²çŠ¶æ€..."
            echo "é¡¹ç›®: ${{ github.event.inputs.project }}"
            echo "éƒ¨ç½²è·¯å¾„: ${{ github.event.inputs.deploy_path }}"
            echo "æ£€æŸ¥æ—¶é—´: $(date)"
            echo ""
            
            # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
            if [ -d "${{ github.event.inputs.deploy_path }}" ]; then
              echo "âœ… éƒ¨ç½²ç›®å½•å­˜åœ¨"
              echo "ğŸ“ ç›®å½•å†…å®¹:"
              ls -la "${{ github.event.inputs.deploy_path }}"
              echo ""
              
              # æ£€æŸ¥å…³é”®æ–‡ä»¶
              echo "ğŸ”‘ å…³é”®æ–‡ä»¶æ£€æŸ¥:"
              if [ -f "${{ github.event.inputs.deploy_path }}/index.html" ]; then
                echo "âœ… index.html å­˜åœ¨"
                echo "   å¤§å°: $(du -h "${{ github.event.inputs.deploy_path }}/index.html" | cut -f1)"
                echo "   ä¿®æ”¹æ—¶é—´: $(stat -c %y "${{ github.event.inputs.deploy_path }}/index.html")"
              else
                echo "âŒ index.html ä¸å­˜åœ¨"
              fi
              
              if [ -d "${{ github.event.inputs.deploy_path }}/assets" ]; then
                echo "âœ… assets ç›®å½•å­˜åœ¨"
                echo "   æ–‡ä»¶æ•°é‡: $(find "${{ github.event.inputs.deploy_path }}/assets" -type f | wc -l)"
              else
                echo "âŒ assets ç›®å½•ä¸å­˜åœ¨"
              fi
              
              echo ""
              
              # æ£€æŸ¥ Nginx é…ç½®
              echo "ğŸŒ Nginx é…ç½®æ£€æŸ¥:"
              if command -v nginx &> /dev/null; then
                echo "âœ… Nginx å·²å®‰è£…"
                nginx -t 2>&1 | head -5
              else
                echo "âŒ Nginx æœªå®‰è£…"
              fi
              
              echo ""
              
              # æ£€æŸ¥ç«¯å£ç›‘å¬
              echo "ğŸ”Œ ç«¯å£ç›‘å¬æ£€æŸ¥:"
              netstat -tlnp | grep :80 || echo "âŒ 80ç«¯å£æœªç›‘å¬"
              
            else
              echo "âŒ éƒ¨ç½²ç›®å½•ä¸å­˜åœ¨: ${{ github.event.inputs.deploy_path }}"
            fi 