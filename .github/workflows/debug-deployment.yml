name: Debug Deployment Issues

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: è°ƒè¯•éƒ¨ç½²é—®é¢˜
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          port: ${{ secrets.SERVER_PORT }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_KEY }}
          script: |
            echo "ğŸ” è°ƒè¯•éƒ¨ç½²é—®é¢˜..."
            echo "æ£€æŸ¥æ—¶é—´: $(date)"
            echo ""
            
            # æ£€æŸ¥ç›®å½•ç»“æ„
            echo "ğŸ“ æ£€æŸ¥ /www/wwwroot ç›®å½•:"
            if [ -d "/www/wwwroot" ]; then
              echo "âœ… /www/wwwroot ç›®å½•å­˜åœ¨"
              echo "ğŸ“ ç›®å½•å†…å®¹:"
              ls -la /www/wwwroot/
            else
              echo "âŒ /www/wwwroot ç›®å½•ä¸å­˜åœ¨"
              echo "ğŸ” æ£€æŸ¥ /www ç›®å½•:"
              if [ -d "/www" ]; then
                echo "âœ… /www ç›®å½•å­˜åœ¨"
                ls -la /www/
              else
                echo "âŒ /www ç›®å½•ä¹Ÿä¸å­˜åœ¨"
              fi
            fi
            
            echo ""
            
            # æ£€æŸ¥ç”¨æˆ·æƒé™
            echo "ğŸ‘¤ æ£€æŸ¥ç”¨æˆ·æƒé™:"
            echo "å½“å‰ç”¨æˆ·: $(whoami)"
            echo "ç”¨æˆ·ç»„: $(groups)"
            echo ""
            
            # æ£€æŸ¥ç£ç›˜ç©ºé—´
            echo "ğŸ’¾ æ£€æŸ¥ç£ç›˜ç©ºé—´:"
            df -h
            echo ""
            
            # æ£€æŸ¥ SSH è¿æ¥
            echo "ğŸ”Œ æ£€æŸ¥ SSH è¿æ¥:"
            echo "SSH æœåŠ¡çŠ¶æ€:"
            systemctl status sshd --no-pager -l || echo "æ— æ³•æ£€æŸ¥ SSH çŠ¶æ€"
            echo ""
            
            # æ£€æŸ¥ç½‘ç»œè¿æ¥
            echo "ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥:"
            ping -c 3 8.8.8.8 || echo "ç½‘ç»œè¿æ¥å¤±è´¥"
            echo ""
            
            # å°è¯•åˆ›å»ºæµ‹è¯•ç›®å½•
            echo "ğŸ§ª å°è¯•åˆ›å»ºæµ‹è¯•ç›®å½•:"
            mkdir -p /www/wwwroot/test-deploy
            if [ $? -eq 0 ]; then
              echo "âœ… å¯ä»¥åˆ›å»ºç›®å½•"
              echo "æµ‹è¯•æ–‡ä»¶å†…å®¹:" > /www/wwwroot/test-deploy/test.txt
              echo "éƒ¨ç½²æµ‹è¯• - $(date)" >> /www/wwwroot/test-deploy/test.txt
              echo "âœ… å¯ä»¥å†™å…¥æ–‡ä»¶"
              rm -rf /www/wwwroot/test-deploy
            else
              echo "âŒ æ— æ³•åˆ›å»ºç›®å½•"
            fi 