name: Get Project Port

on:
  workflow_call:
    inputs:
      project:
        description: 'é¡¹ç›®åç§°'
        required: true
        type: string
    outputs:
      port:
        description: 'é¡¹ç›®ç«¯å£'
        value: ${{ jobs.get-port.outputs.port }}

jobs:
  get-port:
    runs-on: ubuntu-latest
    outputs:
      port: ${{ steps.get-port.outputs.port }}
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: èŽ·å–é¡¹ç›®ç«¯å£
        id: get-port
        run: |
          PROJECT_NAME="${{ inputs.project }}"
          echo "ðŸ” èŽ·å–é¡¹ç›®ç«¯å£é…ç½®..."
          
          # ä»Žç«¯å£é…ç½®æ–‡ä»¶èŽ·å–ç«¯å£
          if [ -f "port-config.yml" ]; then
            PORT=$(grep -A 1 "^  $PROJECT_NAME:" port-config.yml | grep "port:" | awk '{print $2}')
            if [ -z "$PORT" ]; then
              echo "âš ï¸  é¡¹ç›® '$PROJECT_NAME' åœ¨ç«¯å£é…ç½®ä¸­æœªæ‰¾åˆ°ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£8080"
              PORT="8080"
            else
              echo "âœ… èŽ·å–åˆ°é¡¹ç›®ç«¯å£: $PORT"
            fi
          else
            echo "âš ï¸  ç«¯å£é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£8080"
            PORT="8080"
          fi
          
          echo "port=$PORT" >> $GITHUB_OUTPUT
