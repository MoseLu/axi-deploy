name: Test Deployment Status

on:
  workflow_dispatch:
    inputs:
      project:
        description: 'é¡¹ç›®åç§°'
        required: true
        type: string
      deploy_path:
        description: 'éƒ¨ç½²è·¯å¾„'
        required: true
        type: string

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          port: ${{ secrets.SERVER_PORT }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_KEY }}
          script: |
            echo "ğŸ” æ£€æŸ¥éƒ¨ç½²çŠ¶æ€..."
            echo "é¡¹ç›®: ${{ github.event.inputs.project }}"
            echo "éƒ¨ç½²è·¯å¾„: ${{ github.event.inputs.deploy_path }}"
            echo "æ£€æŸ¥æ—¶é—´: $(date)"
            echo ""
            
            # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
            if [ -d "${{ github.event.inputs.deploy_path }}" ]; then
              echo "âœ… éƒ¨ç½²ç›®å½•å­˜åœ¨"
              echo "ğŸ“ ç›®å½•å†…å®¹:"
              ls -la "${{ github.event.inputs.deploy_path }}"
              echo ""
              
              # æ˜¾ç¤ºæ–‡ä»¶ç»Ÿè®¡
              echo "ğŸ“Š æ–‡ä»¶ç»Ÿè®¡:"
              file_count=$(find "${{ github.event.inputs.deploy_path }}" -type f | wc -l)
              dir_count=$(find "${{ github.event.inputs.deploy_path }}" -type d | wc -l)
              echo "æ–‡ä»¶æ•°é‡: $file_count"
              echo "ç›®å½•æ•°é‡: $dir_count"
              echo ""
              
              # æ˜¾ç¤ºæœ€æ–°ä¿®æ”¹çš„æ–‡ä»¶
              echo "ğŸ•’ æœ€æ–°ä¿®æ”¹çš„æ–‡ä»¶ (å‰10ä¸ª):"
              find "${{ github.event.inputs.deploy_path }}" -type f -exec ls -la {} \; | sort -k6,7 | tail -10
              echo ""
              
              # æ£€æŸ¥å…³é”®æ–‡ä»¶
              echo "ğŸ”‘ å…³é”®æ–‡ä»¶æ£€æŸ¥:"
              if [ -f "${{ github.event.inputs.deploy_path }}/index.html" ]; then
                echo "âœ… index.html å­˜åœ¨"
                echo "   å¤§å°: $(du -h "${{ github.event.inputs.deploy_path }}/index.html" | cut -f1)"
                echo "   ä¿®æ”¹æ—¶é—´: $(stat -c %y "${{ github.event.inputs.deploy_path }}/index.html")"
              else
                echo "âŒ index.html ä¸å­˜åœ¨"
              fi
              
              if [ -f "${{ github.event.inputs.deploy_path }}/assets" ]; then
                echo "âœ… assets ç›®å½•å­˜åœ¨"
              else
                echo "âŒ assets ç›®å½•ä¸å­˜åœ¨"
              fi
              
              echo ""
              
              # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ
              echo "ğŸ’¾ ç£ç›˜ä½¿ç”¨æƒ…å†µ:"
              df -h "${{ github.event.inputs.deploy_path }}"
              echo ""
              
              # æ˜¾ç¤ºç›®å½•å¤§å°
              echo "ğŸ“ éƒ¨ç½²ç›®å½•å¤§å°:"
              du -sh "${{ github.event.inputs.deploy_path }}"
              
            else
              echo "âŒ éƒ¨ç½²ç›®å½•ä¸å­˜åœ¨: ${{ github.event.inputs.deploy_path }}"
              echo ""
              echo "ğŸ” æ£€æŸ¥çˆ¶ç›®å½•:"
              parent_dir=$(dirname "${{ github.event.inputs.deploy_path }}")
              if [ -d "$parent_dir" ]; then
                echo "âœ… çˆ¶ç›®å½•å­˜åœ¨: $parent_dir"
                echo "ğŸ“ çˆ¶ç›®å½•å†…å®¹:"
                ls -la "$parent_dir"
              else
                echo "âŒ çˆ¶ç›®å½•ä¹Ÿä¸å­˜åœ¨: $parent_dir"
              fi
            fi 