name: Deployment Summary

description: "éƒ¨ç½²å®Œæˆæ€»ç»“ - æ˜¾ç¤ºéƒ¨ç½²ç»“æœå’ŒçŠ¶æ€ä¿¡æ¯"

on:
  workflow_call:
    inputs:
      project:
        required: true
        type: string
        description: "é¡¹ç›®åç§°"
      deploy_type:
        required: true
        type: string
        description: "éƒ¨ç½²ç±»å‹"
      source_repo:
        required: true
        type: string
        description: "æºä»“åº“"
      run_id:
        required: true
        type: string
        description: "æ„å»ºè¿è¡ŒID"
      test_url:
        required: false
        type: string
        description: "æµ‹è¯•URL"
        default: ""
      deploy_path:
        required: false
        type: string
        description: "éƒ¨ç½²è·¯å¾„"
        default: ""
      parse_secrets_result:
        required: false
        type: string
        description: "è§£æå¯†é’¥ç»“æœ"
        default: ""
      server_init_result:
        required: false
        type: string
        description: "æœåŠ¡å™¨åˆå§‹åŒ–ç»“æœ"
        default: ""
      validate_artifact_result:
        required: false
        type: string
        description: "éªŒè¯æ„å»ºäº§ç‰©ç»“æœ"
        default: ""
      deploy_project_result:
        required: false
        type: string
        description: "éƒ¨ç½²é¡¹ç›®ç»“æœ"
        default: ""
      configure_nginx_result:
        required: false
        type: string
        description: "é…ç½®Nginxç»“æœ"
        default: ""
      start_service_result:
        required: false
        type: string
        description: "å¯åŠ¨æœåŠ¡ç»“æœ"
        default: ""
      test_website_static_result:
        required: false
        type: string
        description: "æµ‹è¯•ç½‘ç«™(é™æ€)ç»“æœ"
        default: ""
      test_website_backend_result:
        required: false
        type: string
        description: "æµ‹è¯•ç½‘ç«™(åç«¯)ç»“æœ"
        default: ""

jobs:
  summary:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # éƒ¨ç½²æ€»ç»“è¶…æ—¶æ—¶é—´
    steps:
      - name: éƒ¨ç½²å®Œæˆæ€»ç»“
        run: |
          echo "ğŸ‰ éƒ¨ç½²æµç¨‹å®Œæˆ"
          echo "=========================================="
          echo "ğŸ“‹ éƒ¨ç½²ä¿¡æ¯:"
          echo "- é¡¹ç›®: ${{ inputs.project }}"
          echo "- éƒ¨ç½²ç±»å‹: ${{ inputs.deploy_type }}"
          echo "- æºä»“åº“: ${{ inputs.source_repo }}"
          echo "- æ„å»ºID: ${{ inputs.run_id }}"
          echo ""
          echo "ğŸ“Š æ‰§è¡ŒçŠ¶æ€:"
          echo "- è§£æå¯†é’¥: ${{ inputs.parse_secrets_result }}"
          echo "- æœåŠ¡å™¨åˆå§‹åŒ–: ${{ inputs.server_init_result || 'skipped' }}"
          echo "- éªŒè¯æ„å»ºäº§ç‰©: ${{ inputs.validate_artifact_result }}"
          echo "- éƒ¨ç½²é¡¹ç›®: ${{ inputs.deploy_project_result }}"
          echo "- é…ç½®Nginx: ${{ inputs.configure_nginx_result || 'skipped' }}"
          echo "- å¯åŠ¨æœåŠ¡: ${{ inputs.start_service_result || 'skipped' }}"
          echo "- æµ‹è¯•ç½‘ç«™(é™æ€): ${{ inputs.test_website_static_result || 'skipped' }}"
          echo "- æµ‹è¯•ç½‘ç«™(åç«¯): ${{ inputs.test_website_backend_result || 'skipped' }}"
          echo ""
          echo "ğŸ”— è®¿é—®ä¿¡æ¯:"
          echo "- åŸŸå: redamancy.com.cn"
          if [ "${{ inputs.deploy_path }}" != "" ]; then
            echo "- é¡¹ç›®è·¯å¾„: ${{ inputs.deploy_path }}"
          fi
          if [ "${{ inputs.test_url }}" != "" ]; then
            echo "- æµ‹è¯•URL: ${{ inputs.test_url }}"
          fi
          echo ""
          echo "ğŸ“ éƒ¨ç½²å®Œæˆé€šçŸ¥:"
          echo "âœ… é¡¹ç›® ${{ inputs.project }} å·²æˆåŠŸéƒ¨ç½²åˆ°æœåŠ¡å™¨"
          if [ "${{ inputs.test_url }}" != "" ]; then
            echo "ğŸŒ å¯é€šè¿‡ ${{ inputs.test_url }} è®¿é—®"
          fi
          echo "=========================================="
