name: Deployment Summary

description: "部署完成总结 - 显示部署结果和状态信息"

on:
  workflow_call:
    inputs:
      project:
        required: true
        type: string
        description: "项目名称"
      deploy_type:
        required: true
        type: string
        description: "部署类型"
      source_repo:
        required: true
        type: string
        description: "源仓库"
      run_id:
        required: true
        type: string
        description: "构建运行ID"
      test_url:
        required: false
        type: string
        description: "测试URL"
        default: ""
      deploy_path:
        required: false
        type: string
        description: "部署路径"
        default: ""
      parse_secrets_result:
        required: false
        type: string
        description: "解析密钥结果"
        default: ""
      server_init_result:
        required: false
        type: string
        description: "服务器初始化结果"
        default: ""
      validate_artifact_result:
        required: false
        type: string
        description: "验证构建产物结果"
        default: ""
      deploy_project_result:
        required: false
        type: string
        description: "部署项目结果"
        default: ""
      configure_nginx_result:
        required: false
        type: string
        description: "配置Nginx结果"
        default: ""
      start_service_result:
        required: false
        type: string
        description: "启动服务结果"
        default: ""
      test_website_static_result:
        required: false
        type: string
        description: "测试网站(静态)结果"
        default: ""
      test_website_backend_result:
        required: false
        type: string
        description: "测试网站(后端)结果"
        default: ""

jobs:
  summary:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # 部署总结超时时间
    steps:
      - name: 部署完成总结
        run: |
          echo "🎉 部署流程完成"
          echo "=========================================="
          echo "📋 部署信息:"
          echo "- 项目: ${{ inputs.project }}"
          echo "- 部署类型: ${{ inputs.deploy_type }}"
          echo "- 源仓库: ${{ inputs.source_repo }}"
          echo "- 构建ID: ${{ inputs.run_id }}"
          echo ""
          echo "📊 执行状态:"
          echo "- 解析密钥: ${{ inputs.parse_secrets_result }}"
          echo "- 服务器初始化: ${{ inputs.server_init_result || 'skipped' }}"
          echo "- 验证构建产物: ${{ inputs.validate_artifact_result }}"
          echo "- 部署项目: ${{ inputs.deploy_project_result }}"
          echo "- 配置Nginx: ${{ inputs.configure_nginx_result || 'skipped' }}"
          echo "- 启动服务: ${{ inputs.start_service_result || 'skipped' }}"
          echo "- 测试网站(静态): ${{ inputs.test_website_static_result || 'skipped' }}"
          echo "- 测试网站(后端): ${{ inputs.test_website_backend_result || 'skipped' }}"
          echo ""
          echo "🔗 访问信息:"
          echo "- 域名: redamancy.com.cn"
          if [ "${{ inputs.deploy_path }}" != "" ]; then
            echo "- 项目路径: ${{ inputs.deploy_path }}"
          fi
          if [ "${{ inputs.test_url }}" != "" ]; then
            echo "- 测试URL: ${{ inputs.test_url }}"
          fi
          echo ""
          echo "📝 部署完成通知:"
          echo "✅ 项目 ${{ inputs.project }} 已成功部署到服务器"
          if [ "${{ inputs.test_url }}" != "" ]; then
            echo "🌐 可通过 ${{ inputs.test_url }} 访问"
          fi
          echo "=========================================="
