name: Test Retry Center

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - '.github/workflows/retry-center.yml'

jobs:
  test-retry-center:
    uses: ./.github/workflows/retry-center.yml
    with:
      step_name: "测试成功命令"
      command: "echo '测试成功' && exit 0"
      max_retries: 2
      retry_delay: 1
      timeout_minutes: 5
      retry_strategy: "simple"
      continue_on_error: false
      notify_on_failure: false
      
  test-retry-center-failure:
    uses: ./.github/workflows/retry-center.yml
    with:
      step_name: "测试失败命令"
      command: "echo '测试失败' && exit 1"
      max_retries: 2
      retry_delay: 1
      timeout_minutes: 5
      retry_strategy: "simple"
      continue_on_error: true
      notify_on_failure: false
      
  display-results:
    runs-on: ubuntu-latest
    needs: [test-retry-center, test-retry-center-failure]
    steps:
      - name: 显示重试结果
        run: |
          echo "重试中心测试完成"
          echo ""
          echo "成功案例结果:"
          echo "成功状态: ${{ needs.test-retry-center.outputs.success }}"
          echo "尝试次数: ${{ needs.test-retry-center.outputs.attempts }}"
          echo "执行时间: ${{ needs.test-retry-center.outputs.execution_time }}秒"
          echo ""
          echo "失败案例结果:"
          echo "成功状态: ${{ needs.test-retry-center-failure.outputs.success }}"
          echo "尝试次数: ${{ needs.test-retry-center-failure.outputs.attempts }}"
          echo "执行时间: ${{ needs.test-retry-center-failure.outputs.execution_time }}秒"
          echo "错误信息: ${{ needs.test-retry-center-failure.outputs.error_message }}"
