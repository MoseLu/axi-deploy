name: Test Deploy

on:
  workflow_dispatch:
    inputs:
      project:
        description: '项目名称'
        required: true
        type: string
        default: 'axi-docs'
      source_repo:
        description: '源仓库'
        required: true
        type: string
        default: 'MoseLu/axi-docs'
      run_id:
        description: '构建运行ID'
        required: true
        type: string
        default: '16822875024'
      deploy_secrets:
        description: '部署密钥 (JSON格式)'
        required: true
        type: string
        default: '{"SERVER_HOST":"your-server.com","SERVER_PORT":"22","SERVER_USER":"deploy","SERVER_KEY":"your-key","DEPLOY_CENTER_PAT":"your-pat"}'

jobs:
  test-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 测试部署
        uses: ./.github/workflows/main-deployment.yml
        with:
          project: ${{ inputs.project }}
          source_repo: ${{ inputs.source_repo }}
          run_id: ${{ inputs.run_id }}
          deploy_type: 'static'
          deploy_secrets: ${{ inputs.deploy_secrets }}
          nginx_config: |
            location /docs/ {
              alias /srv/static/axi-docs/;
              index index.html;
              try_files $uri $uri/ /docs/index.html;
            }
          test_url: 'https://redamancy.com.cn/docs/'
